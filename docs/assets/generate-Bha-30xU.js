(function(){"use strict";function M(t){return t==="binary"?1:t==="octal"?3:4}function p(t,e,n){if(t.length<2)return"";const i=[];if(n.circular){const r=t.length,a=e;for(let h=0;h<r;h++){const b=t[h],u=(t[(h+1)%r]-b+a)%a||a;i.push(u)}}else{for(let r=0;r<t.length-1;r++)i.push(t[r+1]-t[r]);if(i.length<2)return""}const s=O(i,n.circular),o=[s];if(n.rotationInvariant&&o.push(...C(s)),n.reflectionInvariant){const r=k(s);o.push(r,...C(r))}return A(o)}function O(t,e){const n=[],i=t.length,s=e?i:i-1;for(let o=0;o<s;o++){const r=t[o],a=t[(o+1)%i];n.push(a===r?"S":a>r?"U":"D")}return n.join("")}function C(t){const e=[];for(let n=1;n<t.length;n++)e.push(t.slice(n)+t.slice(0,n));return e}function k(t){const e=n=>n==="U"?"D":n==="D"?"U":"S";return t.split("").reverse().map(e).join("")}function A(t){let e=t[0];for(const n of t)n<e&&(e=n);return e}let y=!1;self.onmessage=t=>{const e=t.data;if(e.type==="stop"){y=!0;return}e.type==="start"&&(y=!1,R(e.payload).catch(()=>{}))};function E(t){const e=1<<t,n=new Array(e);for(let i=0;i<e;i++){const s=[];for(let o=0;o<t;o++)i>>t-1-o&1&&s.push(o);n[i]=s}return n}async function R(t){const e=t.mode==="binary"?2:t.mode==="octal"?8:16,n=M(t.mode),i=t.numerator*t.denominator,s=i*n,o=E(n),r=new Array(i).fill(0),a=t.maxReps<=0?Number.POSITIVE_INFINITY:Math.max(1,t.maxReps),h=200,b=2e3;let g=0,u=0,v=[],j=!1;const D=()=>{v.length&&(self.postMessage({type:"batch",items:v}),v=[])};for(;!j&&!y&&g<a;){if(!t.excludeTrivial||!(w(r,0)||w(r,e-1))){const c=[];for(let l=0;l<i;l++){const f=r[l],d=o[f];if(d.length){const S=l*n;for(let x=0;x<d.length;x++)c.push(S+d[x])}}const m=c.length;if(m>=t.minOnsets&&m<=t.maxOnsets){let l=!0;if(t.onlyIsomorphic){const f=T(c,s);if(f.length<2||c.length<2)l=!1;else{const d=p(c,s,{circular:t.circular,rotationInvariant:t.rotationInvariant,reflectionInvariant:t.reflectionInvariant}),S=p(f,s,{circular:t.circular,rotationInvariant:t.rotationInvariant,reflectionInvariant:t.reflectionInvariant});l=d.length>0&&d===S}}if(l){const f=P(r,t.mode,t.denominator);v.push({id:`${t.mode}:${f}:${g}`,base:t.mode,groupedDigitsString:f,onsets:m,canonicalContour:p(c,s,{circular:t.circular,rotationInvariant:t.rotationInvariant,reflectionInvariant:t.reflectionInvariant})}),g++}}}u++,u%h===0&&D(),u%b===0&&(self.postMessage({type:"progress",processed:u,emitted:g}),await U());let I=1;for(let c=i-1;c>=0&&I;c--){const m=r[c]+I;m>=e?(r[c]=0,I=1):(r[c]=m,I=0)}I&&(j=!0)}D(),self.postMessage({type:"progress",processed:u,emitted:g}),self.postMessage({type:"done"})}function T(t,e){const n=new Array(e-t.length);let i=0,s=0;for(let o=0;o<e;o++)i<t.length&&t[i]===o?i++:n[s++]=o;return n}function P(t,e,n){const i=o=>e==="hex"?o.toString(16).toUpperCase():String(o),s=[];for(let o=0;o<t.length;o+=n)s.push(t.slice(o,o+n).map(i).join(""));return s.join(" ")}function w(t,e){for(let n=0;n<t.length;n++)if(t[n]!==e)return!1;return!0}function U(){return new Promise(t=>setTimeout(t,0))}})();
