(function(){"use strict";function U(t){return t==="binary"?1:t==="octal"?3:4}function S(t,n,e){if(t.length<2)return"";const r=[];if(e.circular){const s=t.length,c=n;for(let l=0;l<s;l++){const u=t[l],d=(t[(l+1)%s]-u+c)%c||c;r.push(d)}}else{for(let s=0;s<t.length-1;s++)r.push(t[s+1]-t[s]);if(r.length<3)return""}const o=A(r,e.circular),i=[o];if(e.rotationInvariant&&i.push(...b(o)),e.reflectionInvariant){const s=E(o);i.push(s,...b(s))}return N(i)}function V(t,n,e){if(t.length<2)return"";const r=[];{const l=t.length,u=n;for(let h=0;h<l;h++){const d=t[h],I=(t[(h+1)%l]-d+u)%u||u;r.push(I)}}const o=r.length,i=new Array(o);for(let l=0;l<o;l++){const u=r[(l-1+o)%o],h=r[l];i[l]=u+h}const s=A(i,e.circular),c=[s];c.push(...b(s));{const l=E(s);c.push(l,...b(l))}return N(c)}function A(t,n){const e=[],r=t.length,o=n?r:r-1;for(let i=0;i<o;i++){const s=t[i],c=t[(i+1)%r];e.push(c===s?"S":c>s?"U":"D")}return e.join("")}function b(t){const n=[];for(let e=1;e<t.length;e++)n.push(t.slice(e)+t.slice(0,e));return n}function E(t){const n=e=>e==="U"?"D":e==="D"?"U":"S";return t.split("").reverse().map(n).join("")}function N(t){let n=t[0];for(const e of t)e<n&&(n=e);return n}function w(t,n){if(t.length<2)return[];const e=[],r=t.length;for(let o=0;o<r;o++){const i=t[o],c=(t[(o+1)%r]-i+n)%n||n;e.push(c)}return e}function B(t,n){if(t.length===0)return!1;if(t.length===1)return!0;const e=t.length,r=w(t,n),o=Math.floor(n/e),i=Math.ceil(n/e),s=n%e;let c=0,l=0;for(const u of r)if(u===o)c++;else if(u===i)l++;else return!1;return l===s&&c===e-s}function j(t,n){if(n%2!==0)return!0;const e=n/2,r=t.length;if(r===0)return!0;const o=t.concat(t);for(let i=0;i<r;i++){let s=0;for(let c=1;c<r;c++){if(s+=o[i+c-1],s===e)return!1;if(s>e)break}}return!0}function q(t,n){if(t.length<2||n%2!==0)return!1;const e=w(t,n);for(const r of e)if(r!==2&&r!==3)return!1;return j(e,n)}function z(t,n){if(t.length<2||n%2!==0)return!1;const e=w(t,n);for(const r of e)if(r%2===0)return!1;return j(e,n)}function H(t,n){if(n%2!==0)return!0;const e=n/2,r=new Set(t);for(const o of t){const i=(o+e)%n;if(r.has(i))return!1}return!0}function k(t){return t<=0?0:Math.floor((Math.sqrt(1+8*t)-1)/2)}function _(t){const n=t.length;if(n===0)return 0;const e=new Map;for(const o of t)e.set(o,(e.get(o)??0)+1);let r=0;for(const[,o]of e){const i=o/n;r+=i*Math.log(i)}return r===0?0:-r}const M=new Map;function $(t,n){if(t.length<2){let i=M.get(n);return i===void 0&&(i=Math.log(k(n)*.5),M.set(n,i)),0<i}const e=w(t,n),r=_(e);let o=M.get(n);return o===void 0&&(o=Math.log(k(n)*.5),M.set(n,o)),r<o}function T(t,n){const e=Math.floor(n/2);if(e<=0)return[];const r=new Array(e).fill(0),o=new Uint8Array(n);for(const i of t)i>=0&&i<n&&(o[i]=1);for(let i=1;i<=e;i++){let s=0;for(let c=0;c<n;c++)o[c]&&o[(c+i)%n]&&s++;i===e&&n%2===0&&(s=Math.floor(s/2)),r[i-1]=s}return r}function R(t,n){const e=T(t,n);if(e.length===0)return!0;const r=[];for(let o=0;o<e.length;o++)e[o]!==0&&r.push(o);if(r.length<=1)return!0;for(let o=0;o<r.length-1;o++)if(r[o+1]-r[o]!==1)return!1;return!0}function G(t,n){if(t<0||n<0||n>t)throw new Error("Invalid n,k for binomial");n>t-n&&(n=t-n);let e=1;for(let r=0;r<n;r++)e=e*(t-r)/(r+1);return e}function W(t){return G(t+1,2)}function Y(t,n){if(!R(t,n))return!1;const e=t.length;if(e<1)return!1;const o=T(t,n).filter(c=>c!==0),i=o.length;if(i===0)return!1;const s=W(e)/i;for(const c of o)if(Math.abs(c-s)>.5*s)return!1;return!0}function Z(t){const n=[];for(let e=1;e*e<=t;e++)t%e===0&&(n.push(e),e*e!==t&&n.push(t/e));return n.sort((e,r)=>e-r)}const D=new Map;function J(t){const n=new Set,e="0".repeat(t);n.add(e);for(const r of Z(t)){const o=Math.floor(t/r);for(let i=1;i<=o;i++){const s=new Array(t).fill(0),c=new Array(t).fill(0);for(let l=0;l<i;l++){s[l*r]=1;const u=t-(l+1)*r;u>=0&&u<t&&(c[u]=1)}n.add(s.join("")),n.add(c.join(""))}}return n}function K(t,n,e){if(e<2||n%e!==0)return!1;let r=D.get(e);r||(r=J(e),D.set(e,r));const o=new Array(n).fill("0");for(const c of t)c>=0&&c<n&&(o[c]="1");const i=o.slice().reverse().join(""),s=n/e;for(let c=0;c<s;c++){const l=i.slice(c*e,(c+1)*e);if(!r.has(l))return!1}return!0}let C=!1;self.onmessage=t=>{const n=t.data;if(n.type==="stop"){C=!0;return}n.type==="start"&&(C=!1,X(n.payload).catch(()=>{}))};function Q(t){const n=1<<t,e=new Array(n);for(let r=0;r<n;r++){const o=[];for(let i=0;i<t;i++)r>>t-1-i&1&&o.push(i);e[r]=o}return e}async function X(t){const n=t.mode==="binary"?2:t.mode==="octal"?8:16,e=U(t.mode),r=t.numerator*t.denominator,o=r*e,i=Q(e),s=new Array(r).fill(0),c=t.maxReps<=0?Number.POSITIVE_INFINITY:Math.max(1,t.maxReps),l=200,u=2e3;let h=0,d=0,p=[],I=!1;const P=()=>{p.length&&(self.postMessage({type:"batch",items:p}),p=[])};for(;!I&&!C&&h<c;){if(!t.excludeTrivial||!(F(s,0)||F(s,n-1))){const a=[];for(let f=0;f<r;f++){const g=s[f],m=i[g];if(m.length){const x=f*e;for(let O=0;O<m.length;O++)a.push(x+m[O])}}const v=a.length;if(v>=t.minOnsets&&v<=t.maxOnsets){let f=!0;if(t.onlyIsomorphic)if(a.length<2)f=!0;else{const g={circular:!0,rotationInvariant:!0,reflectionInvariant:!0},m=S(a,o,g),x=V(a,o,g);f=m.length>0&&m===x}if(f&&t.onlyMaximallyEven&&(f=B(a,o)),f&&t.oddityType!=="off")switch(t.oddityType){case"rop23":f=q(a,o);break;case"odd-intervals":f=z(a,o);break;case"no-antipodes":f=H(a,o);break}if(f&&t.onlyLowEntropy&&(f=$(a,o)),f&&t.onlyHasNoGaps&&(f=R(a,o)),f&&t.onlyRelativelyFlat&&(f=Y(a,o)),f&&t.ordinalEnabled&&t.ordinalN&&t.ordinalN>=2&&(f=K(a,o,t.ordinalN)),f){const g=L(s,t.mode,t.denominator);p.push({id:`${t.mode}:${g}:${h}`,base:t.mode,groupedDigitsString:g,onsets:v,canonicalContour:S(a,o,{circular:t.circular,rotationInvariant:t.rotationInvariant,reflectionInvariant:t.reflectionInvariant})}),h++}}}d++,d%l===0&&P(),d%u===0&&(self.postMessage({type:"progress",processed:d,emitted:h}),await tt());let y=1;for(let a=r-1;a>=0&&y;a--){const v=s[a]+y;v>=n?(s[a]=0,y=1):(s[a]=v,y=0)}y&&(I=!0)}P(),self.postMessage({type:"progress",processed:d,emitted:h}),self.postMessage({type:"done"})}function L(t,n,e){const r=i=>n==="hex"?i.toString(16).toUpperCase():String(i),o=[];for(let i=0;i<t.length;i+=e)o.push(t.slice(i,i+e).map(r).join(""));return o.join(" ")}function F(t,n){for(let e=0;e<t.length;e++)if(t[e]!==n)return!1;return!0}function tt(){return new Promise(t=>setTimeout(t,0))}})();
