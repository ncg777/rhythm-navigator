(function(){"use strict";function A(t){return t==="binary"?1:t==="octal"?3:4}function w(t,e,n){if(t.length<2)return"";const r=[];if(n.circular){const s=t.length,l=e;for(let c=0;c<s;c++){const f=t[c],h=(t[(c+1)%s]-f+l)%l||l;r.push(h)}}else{for(let s=0;s<t.length-1;s++)r.push(t[s+1]-t[s]);if(r.length<3)return""}const i=O(r,n.circular),o=[i];if(n.rotationInvariant&&o.push(...b(i)),n.reflectionInvariant){const s=D(i);o.push(s,...b(s))}return M(o)}function E(t,e,n){if(t.length<2)return"";const r=[];{const c=t.length,f=e;for(let a=0;a<c;a++){const h=t[a],v=(t[(a+1)%c]-h+f)%f||f;r.push(v)}}const i=r.length,o=new Array(i);for(let c=0;c<i;c++){const f=r[(c-1+i)%i],a=r[c];o[c]=f+a}const s=O(o,n.circular),l=[s];l.push(...b(s));{const c=D(s);l.push(c,...b(c))}return M(l)}function O(t,e){const n=[],r=t.length,i=e?r:r-1;for(let o=0;o<i;o++){const s=t[o],l=t[(o+1)%r];n.push(l===s?"S":l>s?"U":"D")}return n.join("")}function b(t){const e=[];for(let n=1;n<t.length;n++)e.push(t.slice(n)+t.slice(0,n));return e}function D(t){const e=n=>n==="U"?"D":n==="D"?"U":"S";return t.split("").reverse().map(e).join("")}function M(t){let e=t[0];for(const n of t)n<e&&(e=n);return e}let S=!1;self.onmessage=t=>{const e=t.data;if(e.type==="stop"){S=!0;return}e.type==="start"&&(S=!1,T(e.payload).catch(()=>{}))};function R(t){const e=1<<t,n=new Array(e);for(let r=0;r<e;r++){const i=[];for(let o=0;o<t;o++)r>>t-1-o&1&&i.push(o);n[r]=i}return n}async function T(t){const e=t.mode==="binary"?2:t.mode==="octal"?8:16,n=A(t.mode),r=t.numerator*t.denominator,i=r*n,o=R(n),s=new Array(r).fill(0),l=t.maxReps<=0?Number.POSITIVE_INFINITY:Math.max(1,t.maxReps),c=200,f=2e3;let a=0,h=0,y=[],v=!1;const k=()=>{y.length&&(self.postMessage({type:"batch",items:y}),y=[])};for(;!v&&!S&&a<l;){if(!t.excludeTrivial||!(j(s,0)||j(s,e-1))){const u=[];for(let g=0;g<r;g++){const m=s[g],p=o[m];if(p.length){const C=g*n;for(let x=0;x<p.length;x++)u.push(C+p[x])}}const d=u.length;if(d>=t.minOnsets&&d<=t.maxOnsets){let g=!0;if(t.onlyIsomorphic)if(u.length<2)g=!0;else{const m={circular:!0,rotationInvariant:!0,reflectionInvariant:!0},p=w(u,i,m),C=E(u,i,m);g=p.length>0&&p===C}if(g){const m=F(s,t.mode,t.denominator);y.push({id:`${t.mode}:${m}:${a}`,base:t.mode,groupedDigitsString:m,onsets:d,canonicalContour:w(u,i,{circular:t.circular,rotationInvariant:t.rotationInvariant,reflectionInvariant:t.reflectionInvariant})}),a++}}}h++,h%c===0&&k(),h%f===0&&(self.postMessage({type:"progress",processed:h,emitted:a}),await L());let I=1;for(let u=r-1;u>=0&&I;u--){const d=s[u]+I;d>=e?(s[u]=0,I=1):(s[u]=d,I=0)}I&&(v=!0)}k(),self.postMessage({type:"progress",processed:h,emitted:a}),self.postMessage({type:"done"})}function F(t,e,n){const r=o=>e==="hex"?o.toString(16).toUpperCase():String(o),i=[];for(let o=0;o<t.length;o+=n)i.push(t.slice(o,o+n).map(r).join(""));return i.join(" ")}function j(t,e){for(let n=0;n<t.length;n++)if(t[n]!==e)return!1;return!0}function L(){return new Promise(t=>setTimeout(t,0))}})();
