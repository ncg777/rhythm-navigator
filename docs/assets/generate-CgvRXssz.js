(function(){"use strict";function B(t){return t==="binary"?1:t==="octal"?3:4}function S(t,n,e){if(t.length<2)return"";const r=[];if(e.circular){const s=t.length,c=n;for(let l=0;l<s;l++){const u=t[l],d=(t[(l+1)%s]-u+c)%c||c;r.push(d)}}else{for(let s=0;s<t.length-1;s++)r.push(t[s+1]-t[s]);if(r.length<3)return""}const o=A(r,e.circular),i=[o];if(e.rotationInvariant&&i.push(...w(o)),e.reflectionInvariant){const s=E(o);i.push(s,...w(s))}return N(i)}function U(t,n,e){if(t.length<2)return"";const r=[];{const l=t.length,u=n;for(let h=0;h<l;h++){const d=t[h],I=(t[(h+1)%l]-d+u)%u||u;r.push(I)}}const o=r.length,i=new Array(o);for(let l=0;l<o;l++){const u=r[(l-1+o)%o],h=r[l];i[l]=u+h}const s=A(i,e.circular),c=[s];c.push(...w(s));{const l=E(s);c.push(l,...w(l))}return N(c)}function A(t,n){const e=[],r=t.length,o=n?r:r-1;for(let i=0;i<o;i++){const s=t[i],c=t[(i+1)%r];e.push(c===s?"S":c>s?"U":"D")}return e.join("")}function w(t){const n=[];for(let e=1;e<t.length;e++)n.push(t.slice(e)+t.slice(0,e));return n}function E(t){const n=e=>e==="U"?"D":e==="D"?"U":"S";return t.split("").reverse().map(n).join("")}function N(t){let n=t[0];for(const e of t)e<n&&(n=e);return n}function m(t,n){if(t.length<2)return[];const e=[],r=t.length;for(let o=0;o<r;o++){const i=t[o],c=(t[(o+1)%r]-i+n)%n||n;e.push(c)}return e}function V(t,n){if(t.length===0)return!1;if(t.length===1)return!0;const e=t.length,r=m(t,n),o=Math.floor(n/e),i=Math.ceil(n/e),s=n%e;let c=0,l=0;for(const u of r)if(u===o)c++;else if(u===i)l++;else return!1;return l===s&&c===e-s}function k(t,n){if(n%2!==0)return!0;const e=n/2,r=t.length;if(r===0)return!0;const o=t.concat(t);for(let i=0;i<r;i++){let s=0;for(let c=1;c<r;c++){if(s+=o[i+c-1],s===e)return!1;if(s>e)break}}return!0}function q(t,n){if(t.length<2||n%2!==0)return!1;const e=m(t,n);for(const r of e)if(r!==2&&r!==3)return!1;return k(e,n)}function H(t,n){if(t.length<2||n%2!==0)return!1;const e=m(t,n);for(const r of e)if(r%2===0)return!1;return k(e,n)}function _(t,n){if(n%2!==0)return!0;const e=n/2,r=new Set(t);for(const o of t){const i=(o+e)%n;if(r.has(i))return!1}return!0}function j(t){return t<=0?0:Math.floor((Math.sqrt(1+8*t)-1)/2)}function $(t){const n=t.length;if(n===0)return 0;const e=new Map;for(const o of t)e.set(o,(e.get(o)??0)+1);let r=0;for(const[,o]of e){const i=o/n;r+=i*Math.log(i)}return r===0?0:-r}const M=new Map;function z(t,n){if(t.length<2){let i=M.get(n);return i===void 0&&(i=Math.log(j(n)*.5),M.set(n,i)),0<i}const e=m(t,n),r=$(e);let o=M.get(n);return o===void 0&&(o=Math.log(j(n)*.5),M.set(n,o)),r<o}function T(t){const n=new Map;for(const e of t)n.set(e,(n.get(e)??0)+1);return n}function R(t,n){const e=m(t,n);if(e.length===0)return!0;const r=T(e),o=Array.from(r.keys()).filter(()=>!0).sort((i,s)=>i-s);if(o.length<=1)return!0;for(let i=0;i<o.length-1;i++)if(o[i+1]-o[i]!==1)return!1;return!0}function G(t,n){if(t<0||n<0||n>t)throw new Error("Invalid n,k for binomial");n>t-n&&(n=t-n);let e=1;for(let r=0;r<n;r++)e=e*(t-r)/(r+1);return e}function W(t){return G(t+1,2)}function Y(t,n){if(!R(t,n))return!1;const e=t.length;if(e<1)return!1;const r=m(t,n),o=T(r),i=Array.from(o.values()).filter(l=>l!==0),s=i.length;if(s===0)return!1;const c=W(e)/s;for(const l of i)if(Math.abs(l-c)>.5*c)return!1;return!0}function Z(t){const n=[];for(let e=1;e*e<=t;e++)t%e===0&&(n.push(e),e*e!==t&&n.push(t/e));return n.sort((e,r)=>e-r)}const D=new Map;function J(t){const n=new Set,e="0".repeat(t);n.add(e);for(const r of Z(t)){const o=Math.floor(t/r);for(let i=1;i<=o;i++){const s=new Array(t).fill(0),c=new Array(t).fill(0);for(let l=0;l<i;l++){s[l*r]=1;const u=t-(l+1)*r;u>=0&&u<t&&(c[u]=1)}n.add(s.join("")),n.add(c.join(""))}}return n}function K(t,n,e){if(e<2||n%e!==0)return!1;let r=D.get(e);r||(r=J(e),D.set(e,r));const o=new Array(n).fill("0");for(const c of t)c>=0&&c<n&&(o[c]="1");const i=o.slice().reverse().join(""),s=n/e;for(let c=0;c<s;c++){const l=i.slice(c*e,(c+1)*e);if(!r.has(l))return!1}return!0}let C=!1;self.onmessage=t=>{const n=t.data;if(n.type==="stop"){C=!0;return}n.type==="start"&&(C=!1,X(n.payload).catch(()=>{}))};function Q(t){const n=1<<t,e=new Array(n);for(let r=0;r<n;r++){const o=[];for(let i=0;i<t;i++)r>>t-1-i&1&&o.push(i);e[r]=o}return e}async function X(t){const n=t.mode==="binary"?2:t.mode==="octal"?8:16,e=B(t.mode),r=t.numerator*t.denominator,o=r*e,i=Q(e),s=new Array(r).fill(0),c=t.maxReps<=0?Number.POSITIVE_INFINITY:Math.max(1,t.maxReps),l=200,u=2e3;let h=0,d=0,y=[],I=!1;const P=()=>{y.length&&(self.postMessage({type:"batch",items:y}),y=[])};for(;!I&&!C&&h<c;){if(!t.excludeTrivial||!(F(s,0)||F(s,n-1))){const f=[];for(let a=0;a<r;a++){const g=s[a],p=i[g];if(p.length){const x=a*e;for(let O=0;O<p.length;O++)f.push(x+p[O])}}const v=f.length;if(v>=t.minOnsets&&v<=t.maxOnsets){let a=!0;if(t.onlyIsomorphic)if(f.length<2)a=!0;else{const g={circular:!0,rotationInvariant:!0,reflectionInvariant:!0},p=S(f,o,g),x=U(f,o,g);a=p.length>0&&p===x}if(a&&t.onlyMaximallyEven&&(a=V(f,o)),a&&t.oddityType!=="off")switch(t.oddityType){case"rop23":a=q(f,o);break;case"odd-intervals":a=H(f,o);break;case"no-antipodes":a=_(f,o);break}if(a&&t.onlyLowEntropy&&(a=z(f,o)),a&&t.onlyHasNoGaps&&(a=R(f,o)),a&&t.onlyRelativelyFlat&&(a=Y(f,o)),a&&t.ordinalEnabled&&t.ordinalN&&t.ordinalN>=2&&(a=K(f,o,t.ordinalN)),a){const g=L(s,t.mode,t.denominator);y.push({id:`${t.mode}:${g}:${h}`,base:t.mode,groupedDigitsString:g,onsets:v,canonicalContour:S(f,o,{circular:t.circular,rotationInvariant:t.rotationInvariant,reflectionInvariant:t.reflectionInvariant})}),h++}}}d++,d%l===0&&P(),d%u===0&&(self.postMessage({type:"progress",processed:d,emitted:h}),await tt());let b=1;for(let f=r-1;f>=0&&b;f--){const v=s[f]+b;v>=n?(s[f]=0,b=1):(s[f]=v,b=0)}b&&(I=!0)}P(),self.postMessage({type:"progress",processed:d,emitted:h}),self.postMessage({type:"done"})}function L(t,n,e){const r=i=>n==="hex"?i.toString(16).toUpperCase():String(i),o=[];for(let i=0;i<t.length;i+=e)o.push(t.slice(i,i+e).map(r).join(""));return o.join(" ")}function F(t,n){for(let e=0;e<t.length;e++)if(t[e]!==n)return!1;return!0}function tt(){return new Promise(t=>setTimeout(t,0))}})();
