(function(){"use strict";function B(t){return t==="binary"?1:t==="octal"?3:4}function A(t,n,e){if(t.length<2)return"";const r=[];if(e.circular){const c=t.length,s=n;for(let l=0;l<c;l++){const u=t[l],v=(t[(l+1)%c]-u+s)%s||s;r.push(v)}}else{for(let c=0;c<t.length-1;c++)r.push(t[c+1]-t[c]);if(r.length<3)return""}const o=E(r,e.circular),i=[o];if(e.rotationInvariant&&i.push(...w(o)),e.reflectionInvariant){const c=N(o);i.push(c,...w(c))}return j(i)}function q(t,n,e){if(t.length<2)return"";const r=[];{const l=t.length,u=n;for(let h=0;h<l;h++){const v=t[h],d=(t[(h+1)%l]-v+u)%u||u;r.push(d)}}const o=r.length,i=new Array(o);for(let l=0;l<o;l++){const u=r[(l-1+o)%o],h=r[l];i[l]=u+h}const c=E(i,e.circular),s=[c];s.push(...w(c));{const l=N(c);s.push(l,...w(l))}return j(s)}function E(t,n){const e=[],r=t.length,o=n?r:r-1;for(let i=0;i<o;i++){const c=t[i],s=t[(i+1)%r];e.push(s===c?"S":s>c?"U":"D")}return e.join("")}function w(t){const n=[];for(let e=1;e<t.length;e++)n.push(t.slice(e)+t.slice(0,e));return n}function N(t){const n=e=>e==="U"?"D":e==="D"?"U":"S";return t.split("").reverse().map(n).join("")}function j(t){let n=t[0];for(const e of t)e<n&&(n=e);return n}function M(t,n){if(t.length<2)return[];const e=[],r=t.length;for(let o=0;o<r;o++){const i=t[o],s=(t[(o+1)%r]-i+n)%n||n;e.push(s)}return e}function z(t,n){if(t.length===0)return!1;if(t.length===1)return!0;const e=t.length,r=M(t,n),o=Math.floor(n/e),i=Math.ceil(n/e),c=n%e;let s=0,l=0;for(const u of r)if(u===o)s++;else if(u===i)l++;else return!1;return l===c&&s===e-c}function k(t,n){if(n%2!==0)return!0;const e=n/2,r=t.length;if(r===0)return!0;const o=t.concat(t);for(let i=0;i<r;i++){let c=0;for(let s=1;s<r;s++){if(c+=o[i+s-1],c===e)return!1;if(c>e)break}}return!0}function H(t,n){if(t.length<2||n%2!==0)return!1;const e=M(t,n);for(const r of e)if(r!==2&&r!==3)return!1;return k(e,n)}function _(t,n){if(t.length<2||n%2!==0)return!1;const e=M(t,n);for(const r of e)if(r%2===0)return!1;return k(e,n)}function $(t,n){if(n%2!==0)return!0;const e=n/2,r=new Set(t);for(const o of t){const i=(o+e)%n;if(r.has(i))return!1}return!0}function D(t){return t<=0?0:Math.floor((Math.sqrt(1+8*t)-1)/2)}function G(t){const n=t.length;if(n===0)return 0;const e=new Map;for(const o of t)e.set(o,(e.get(o)??0)+1);let r=0;for(const[,o]of e){const i=o/n;r+=i*Math.log(i)}return r===0?0:-r}const O=new Map;function W(t,n){if(t.length<2){let i=O.get(n);return i===void 0&&(i=Math.log(D(n)*.5),O.set(n,i)),0<i}const e=M(t,n),r=G(e);let o=O.get(n);return o===void 0&&(o=Math.log(D(n)*.5),O.set(n,o)),r<o}function R(t,n){const e=Math.floor(n/2);if(e<=0)return[];const r=new Array(e).fill(0),o=new Uint8Array(n);for(const i of t)i>=0&&i<n&&(o[i]=1);for(let i=1;i<=e;i++){let c=0;for(let s=0;s<n;s++)o[s]&&o[(s+i)%n]&&c++;i===e&&n%2===0&&(c=Math.floor(c/2)),r[i-1]=c}return r}function T(t,n){const e=R(t,n);if(e.length===0)return!0;const r=[];for(let o=0;o<e.length;o++)e[o]!==0&&r.push(o);if(r.length<=1)return!0;for(let o=0;o<r.length-1;o++)if(r[o+1]-r[o]!==1)return!1;return!0}function Y(t,n){if(t<0||n<0||n>t)throw new Error("Invalid n,k for binomial");n>t-n&&(n=t-n);let e=1;for(let r=0;r<n;r++)e=e*(t-r)/(r+1);return e}function Z(t){return Y(t+1,2)}function J(t,n){if(!T(t,n))return!1;const e=t.length;if(e<1)return!1;const o=R(t,n).filter(s=>s!==0),i=o.length;if(i===0)return!1;const c=Z(e)/i;for(const s of o)if(Math.abs(s-c)>.5*c)return!1;return!0}function K(t){const n=[];for(let e=1;e*e<=t;e++)t%e===0&&(n.push(e),e*e!==t&&n.push(t/e));return n.sort((e,r)=>e-r)}const F=new Map;function Q(t){const n=new Set,e="0".repeat(t);n.add(e);for(const r of K(t)){const o=Math.floor(t/r);for(let i=1;i<=o;i++){const c=new Array(t).fill(0),s=new Array(t).fill(0);for(let l=0;l<i;l++){c[l*r]=1;const u=t-(l+1)*r;u>=0&&u<t&&(s[u]=1)}n.add(c.join("")),n.add(s.join(""))}}return n}function X(t,n,e){if(e<2||n%e!==0)return!1;let r=F.get(e);r||(r=Q(e),F.set(e,r));const o=new Array(n).fill("0");for(const s of t)s>=0&&s<n&&(o[s]="1");const i=o.slice().reverse().join(""),c=n/e;for(let s=0;s<c;s++){const l=i.slice(s*e,(s+1)*e);if(!r.has(l))return!1}return!0}let x=!1;self.onmessage=t=>{const n=t.data;if(n.type==="stop"){x=!0;return}n.type==="start"&&(x=!1,tt(n.payload).catch(()=>{}))};function L(t){const n=1<<t,e=new Array(n);for(let r=0;r<n;r++){const o=[];for(let i=0;i<t;i++)r>>t-1-i&1&&o.push(i);e[r]=o}return e}async function tt(t){const n=t.mode==="binary"?2:t.mode==="octal"?8:16,e=B(t.mode),r=t.numerator*t.denominator,o=r*e,i=L(e),c=typeof t.minOnsets=="number"?t.minOnsets:0,s=typeof t.maxOnsets=="number"?t.maxOnsets:void 0,l=new Array(r).fill(0),u=t.maxReps<=0?Number.POSITIVE_INFINITY:Math.max(1,t.maxReps),h=200,v=2e3;let m=0,d=0,I=[],U=!1;const V=()=>{I.length&&(self.postMessage({type:"batch",items:I}),I=[])};for(;!U&&!x&&m<u;){if(!(P(l,0)||P(l,n-1))){const a=[];for(let f=0;f<r;f++){const g=l[f],y=i[g];if(y.length){const C=f*e;for(let S=0;S<y.length;S++)a.push(C+y[S])}}const p=a.length,rt=typeof s=="number"?s:o;if(p>=c&&p<=rt){let f=!0;if(t.onlyIsomorphic)if(a.length<2)f=!0;else{const g={circular:!0,rotationInvariant:!0,reflectionInvariant:!0},y=A(a,o,g),C=q(a,o,g);f=y.length>0&&y===C}if(f&&t.onlyMaximallyEven&&(f=z(a,o)),f&&t.oddityType!=="off")switch(t.oddityType){case"rop23":f=H(a,o);break;case"odd-intervals":f=_(a,o);break;case"no-antipodes":f=$(a,o);break}if(f&&t.onlyLowEntropy&&(f=W(a,o)),f&&t.onlyHasNoGaps&&(f=T(a,o)),f&&t.onlyRelativelyFlat&&(f=J(a,o)),f&&t.ordinalEnabled&&t.ordinalN&&t.ordinalN>=2&&(f=X(a,o,t.ordinalN)),f){const g=nt(l,t.mode,t.denominator);I.push({id:`${t.mode}:${g}:${m}`,base:t.mode,groupedDigitsString:g,onsets:p,canonicalContour:A(a,o,{circular:!0,rotationInvariant:!0,reflectionInvariant:!0}),numerator:t.numerator,denominator:t.denominator}),m++}}}d++,d%h===0&&V(),d%v===0&&(self.postMessage({type:"progress",processed:d,emitted:m}),await et());let b=1;for(let a=r-1;a>=0&&b;a--){const p=l[a]+b;p>=n?(l[a]=0,b=1):(l[a]=p,b=0)}b&&(U=!0)}V(),self.postMessage({type:"progress",processed:d,emitted:m}),self.postMessage({type:"done"})}function nt(t,n,e){const r=i=>n==="hex"?i.toString(16).toUpperCase():String(i),o=[];for(let i=0;i<t.length;i+=e)o.push(t.slice(i,i+e).map(r).join(""));return o.join(" ")}function P(t,n){for(let e=0;e<t.length;e++)if(t[e]!==n)return!1;return!0}function et(){return new Promise(t=>setTimeout(t,0))}})();
